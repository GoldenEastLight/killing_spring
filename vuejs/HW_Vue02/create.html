<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
  </head>

  <body>
    <h2 class="text-center">Vue를 이용한 게시판</h2>
    <div id="app" class="container">
      <table class="table table-bordered table-condensed">
        <tr>
          <td>이름</td>
          <td>
            <input type="text" class="form-control" id="writer" ref="writer" v-model="writer" />
          </td>
        </tr>
        <tr>
          <td>이메일</td>
          <td>
            <input type="text" class="form-control" id="email" ref="email" v-model="email" />
          </td>
        </tr>
        <tr>
          <td>고용일</td>
          <td>
            <input
              type="text"
              class="form-control"
              id="hiredate"
              ref="hiredate"
              placeholder="연도-월-일"
              v-model="hiredate"
            />
          </td>
        </tr>
        <tr>
          <td>관리자</td>
          <td>
            <input type="text" class="form-control" id="manager" ref="manager" v-model="manager" />
          </td>
        </tr>
        <tr>
          <td>직책</td>
          <td>
            <input type="text" class="form-control" id="job" ref="job" v-model="job" />
          </td>
        </tr>
        <tr>
          <td>부서</td>
          <td>
            <input type="text" class="form-control" id="dept" ref="dept" v-model="dept" />
          </td>
        </tr>
        <tr>
          <td>월급</td>
          <td>
            <input type="text" class="form-control" id="salary" ref="salary" v-model="salary" />
          </td>
        </tr>
        <tr>
          <td>커미션</td>
          <td>
            <input
              type="text"
              class="form-control"
              id="commtition"
              ref="commition"
              placeholder="작성자를 입력하세요"
              v-model="commition"
            />
          </td>
        </tr>
      </table>
      <div class="text-right">
        <button class="btn btn-primary" @click="checkHandler">등록</button>
        <button class="btn btn-primary" @click="moveList">목록</button>
      </div>
    </div>

    <script>
      new Vue({
        el: '#app',
        // 폼 화면 입력값과 연관된 데이터 선언하기
        data: function () {
          return {
            no: '',
            regtime: '',
            writer: '',
            title: '',
            content: '',
          };
        },
        methods: {
          // 입력값 체크하기 - 체크가 성공하면 createHandler 호출
          checkHandler() {
            // 사용자 입력값 체크하기
            // 작성자, 제목, 내용
            // 없을 경우 각 항목에 맞는 메세지를 출력
            let err = true;
            let msg = '';
            !this.writer &&
              ((msg = '작성자를 입력해주세요'), (err = false), this.$refs.writer.focus());
            err &&
              !this.title &&
              ((msg = '제목 입력해주세요'), (err = false), this.$refs.title.focus());
            err &&
              !this.content &&
              ((msg = '내용 입력해주세요'), (err = false), this.$refs.content.focus());

            if (!err) alert(msg);
            // 만약, 내용이 다 입력되어 있다면 createHandler 호출
            else this.createHandler();
          },

          createHandler() {
            // 로컬스토리지에 저장된 데이터 가져오기
            const board = localStorage.getItem('board');
            // 데이터 선언
            let newBoard = {
              sequence: 0,
              items: [],
            };

            // 기존 로컬스토리지에 저장된 내용이 있다면 newBoard 객체를 변경
            if (board) {
              newBoard = JSON.parse(board);
            }

            // 글번호 증가
            newBoard.sequence += 1;
            // 화면 입력된 데이터를 newBoard에 추가
            newBoard.items.push({
              writer: this.writer,
              title: this.title,
              content: this.content,
              no: newBoard.sequence,
              regtime: new Date(),
            });
            // 로컬스트리지 저장
            localStorage.setItem('board', JSON.stringify(newBoard));
            // 등록 성공 메세지 출력
            alert('등록이 완료되었습니다.');
            // 목록 페이지로 이동하기
            location.href = './list.html';
          },
          moveList() {
            location.href = 'list.html';
          },
        },
      });
    </script>
  </body>
</html>
